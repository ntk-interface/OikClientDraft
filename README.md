# Заготовка клиентского приложения «ОИК Диспетчер НТ» OikClientDraft

Проект OikClientDraft представляет собой заготовку клиентского приложения для создания лёгкого фиксированного АРМ сервера «ОИК Диспетчер НТ».

Предлагается воспользоваться исходными кодами репозитария для того, чтобы создать собственное приложение, адаптированное под конечное устройство заказчика с учётом его требований к визуальному отображению информации.

Итоговое приложение будет обладать полной кросс-платформенностью. Функциональность работы проверяется на платформах windows-x64, linux-x64  и linux-arm64.

В отличие от других вариантов ПО рабочих станций «ОИК Диспетчер НТ» (Клиент10, Веб-КлиентX и др.) данное исполнение будет обладать меньшим объемом функционала и интерактивности, больше подходит для визуализации ограниченного набора данных, в том числе на стационарных панелях отображения. При этом приложение не требует наладки и может работать даже в условиях ограниченных возможностей устройств ввода данных.

## Информация для разработчиков

Исходные коды являются открытыми, лицензия MIT (см. файл LICENSE в репозитарии).

Вы можете скачать/склонировать репозитарий, вносить любые изменения в проект под требования заказчика, переименовывать выходной файл проекта, публиковать и использовать приложение без каких-либо ограничений.

Если вы готовы поделиться с нами какими-то изменениями, потенциально полезными для других пользователей, мы будем рады любому пулл-реквесту.

### Технологии
Используется платформа для разработки .NET 8.0, язык C# https://learn.microsoft.com/en-us/dotnet/

Для визуального отображения используется графический фреймворк Avalonia https://docs.avaloniaui.net/docs/welcome

Avalonia использует язык разметки XAML для создания пользовательского интерфейса https://docs.avaloniaui.net/docs/basics/user-interface/introduction-to-xaml

При разработке применен паттерн MVVM https://docs.avaloniaui.net/docs/concepts/the-mvvm-pattern/ с помощью библиотеки ReactiveUI https://docs.avaloniaui.net/docs/concepts/reactiveui/

Для отображения панелей с ручной отрисовкой и с отрисовкой SVG-документа используется кросс-платформенная 2D библиотека SkiaSharp https://github.com/mono/SkiaSharp 

### Инструменты

Разрабатывать и публиковать приложение можно на любой предпочитаемой платформе Windows/Linux

Для внесения изменений рекомендуется использовать одну из следующих IDE:

- Visual Studio (наиболее простой вариант для разработки на ОС Windows)
- Jetbrains Rider
- Visual Studio Code

Дополнительно потребуется установить .NET SDK 8.0 или выше https://dotnet.microsoft.com/en-us/download/dotnet/8.0

Обычно установить нужную версию SDK можно прямо при установке IDE.

При разработке с помощью Visual Studio рекомендуется установить плагин фреймворка Avalonia https://docs.avaloniaui.net/docs/get-started/set-up-an-editor

### Быстрый старт

Для начала работы требуется скачать/склонировать данный репозитарий. После чего открыть решение в любой из приведенных выше IDE.

Запустив глобальный поиск по проекту по слову "TODO" можно найти те места, которые рекомендованы к редактированию для создания своего приложения.

Примечания по файлам, на которые обратить внимание в первую очередь:
- src/OikClientDraft.csproj - XML-файл описания проекта, изменяется имя выходного файла сборки внутри секции `<AssemblyName>OikClientDraft</AssemblyName>`
- src/Vars.cs - глобальные переменные, изменяется название приложения, размеры окна, реквизиты для подключения к серверу ОИК (если требуется статическое подключение) и другие необходимые параметры 
- src/Shell/ShellView.axaml - представление главного окна программы, изменяется разметка окна, при изменении кнопок перехода на страницы обязательно внести изменения в модель представления (см. ниже)
- src/Shell/ShellViewModel.cs - модель представления главного окна программы, изменяется вызов стартового страницы, реакция на кнопки перехода на страницы (см. выше)
- src/Panels/RightPanelView.axaml - представление правой панели окна программы, изменяется разметка панели, при необходимости добавляются другие панели
- src/Panels/RightPanelViewModel.cs - модель представления правой панели окна программы
- src/Screens/... - представления и модели представления экранов-страниц основной части окна программы. См. описание структуры проекты ниже

### Сборка, публикация и запуск проекта

См. скрипты "publish_windows.ps1", "publish_linux.ps1" и "publish_arm.ps1". Они запускаются с помощью кросс-платформенной командной оболочки Powershell https://learn.microsoft.com/en-us/powershell/

Результаты сборки появятся в каталоге "dist" и подкаталоге соответствующей платформы

По умолчанию результат сборки упаковывается в один файл (кроме нативных библиотек), и включает в себя в том числе среду .NET Runtime. Это означает, что не требуется установка дополнительных программ и библиотек на компьютере АРМ.

Приложение можно запускать без аргументов командной строки, в этом случае будут использоваться реквизиты сервера ОИК по умолчанию (см. файл Vars.cs).

Либо реквизиты сервера можно задать с помощью аргументов командной строки, например: `OikClientDraft 10.0.1.12 user password`

### Описание структуры проекта

- libs/ - каталог требуемых библиотек
  - libif_cfs.dll, libif_cfs.so - системные библиотеки сервера ОИК
  - Iface.Oik.Tm.dll, Iface.Oik.Tm.Native.dll - .NET библиотеки сервера ОИК
- src/ - каталог исходного кода приложения
  - OikClientDraft.csproj - файл описания проекта, не рекомендуется к ручному изменению (за исключением изменения имени выходного файла сборки)
  - Program.cs - входная точка приложения, не рекомендуется к изменению
  - Vars.cs - параметры приложения
  - Bootstrapper.cs - регистрация нужных зависимостей приложения, не рекомендуется к изменению
  - App.axaml, App.axaml.cs - входная точка визуальной части приложения, не рекомендуется к изменению
- src/Assets/ - каталог статических ресурсов
  - favicon.ico - иконка приложения для отображения в окне, панели задач и т.п.
  - svg1.svg, canvas2.png - примеры SVG-документа и графической подложки для страниц. При работе удалить, добавить при необходимости свои
- src/Infrastructure/ - каталог инфраструктурных сервисов приложения
  - src/Infrastructure/Converters/ - каталог конвертеров значений для привязки данных к элементам пользовательского интерфейса
  - src/Infrastructure/Services/ - каталог различных сервисов программы
    - src/Infrastructure/Services/OikServices.cs - сервисы связи с сервером ОИК, не рекомендуется к изменению
  - src/Infrastructure/Util/ - каталог различных статических функций
    - src/Infrastructure/Util/IoC.cs - функции для работы с контейнером Inversion of Control 
    - src/Infrastructure/Util/SvgDocumentExtensions.cs - функции для изменения свойств SVG-документа
- src/Styles/ - каталог стилей и цветов приложения
  - src/Styles/Common.xaml - основные стили приложения, здесь указываются размер текста по умолчанию, цвет панелей, цвет и отступы кнопок и т.п.
  - src/Styles/ImportanceColors.cs - цвета уровней важности тревог и событий, используются для отображения таблиц и т.п.
- src/Components/ - каталог всех компонентов приложения (главное окно, панели, страницы и т.д.)
  - src/Components/ViewLocator.cs - системный определитель представлений (Views) Avalonia, не рекомендуется к изменению
  - src/Components/ViewModelBase.cs - родительский компонент, от которого наследуются все модели представлений (ViewModels), не рекомендуется к изменению
  - src/Components/Shell/ - каталог главного окна программы
    - src/Components/Shell/ShellView.axaml - представление главного окна: разбивка окна на панели, кнопки перехода и т.п.
    - src/Components/Shell/ShellViewModel.cs - модель представления главного окна: установка связи с сервером ОИК, обработка нажатия кнопок панелей и т.п.
  - src/Comoponents/Panels/ - каталог панелей окна программы (в предложенном варианте - только правая)
    - src/Components/Panels/RightPanelView.axaml - представление правой панели: в примере отображается монитор тревог в табличном виде
    - src/Components/Panels/RightPanelViewModel.cs - модель представления правой панели: в примере запрашивается монитор тревог
  - src/Components/Screens/ - каталог экранов-страниц основной части окна программы
    - src/Components/ViewModelBase.cs - родительский компонент, от которого наследуются все модели представлений (ViewModels) страниц, не рекомендуется к изменению
    - src/Components/Screens/Canvas1View.axaml - представление страницы с ручной отрисовкой в зависимости от телеметрии
    - src/Components/Screens/Canvas1View.axaml.cs - представление страницы с ручной отрисовкой в зависимости от телеметрии
    - src/Components/Screens/Canvas2ViewModel - модель представления страницы с ручной отрисовкой в зависимости от телеметрии
    - src/Components/Screens/Canvas2ViewModel.cs - модель представления страницы с ручной отрисовкой в зависимости от телеметрии
    - src/Components/Screens/Svg1View.axaml - представление страницы с отрисовкой SVG-документа в зависимости от телеметрии
    - src/Components/Screens/Svg1ViewModel.cs - модель представления страницы с отрисовкой SVG-документа в зависимости от телеметрии
    - src/Components/Screens/Table1View.axaml - представление страницы с выводом табличных данных телеметрии
    - src/Components/Screens/Table1ViewModel.cs - модель представления страницы с выводом табличных данных телеметрии